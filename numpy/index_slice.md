# 索引和切片

- [索引和切片](#索引和切片)
  - [简介](#简介)
    - [赋值和引用](#赋值和引用)
    - [单元素索引](#单元素索引)
    - [其它索引选项](#其它索引选项)
    - [索引数组](#索引数组)
    - [多维数组索引](#多维数组索引)
  - [索引](#索引)
    - [基础切片和索引](#基础切片和索引)
  - [参考](#参考)

2021-08-04, 14:36
***

## 简介

数组索引指使用方括号 `[]` 索引数组值。NumPy 索引功能强大，同时带来了使用的复杂性和混淆的可能。下面对索引相关的问题进行概述。

### 赋值和引用

下面大多数示例展示在引用数组中的数据时如何使用索引。这些示例在赋值给数组时同样有效。

### 单元素索引

1-D 数组的单元素索引和其它标准 Python 序列一样。从 0 开始，可以使用负数倒序索引。例如：

```py
>>> x = np.arange(10)
>>> x[2]
2
>>> x[-2]
8
```

和列表与元组不同的是，NumPy 数组支持多维数组的多维索引。不同维度的索引可以放在一个方括号中：

```py
>>> x.shape = (2,5) # now x is 2-dimensional
>>> x[1,3]
8
>>> x[1,-1]
9
```

如果索引的数目小于数组的维数，则返回子数组。例如：

```py
>>> x[0]
array([0, 1, 2, 3, 4])
```

注意：返回的数组不是原始数据的副本，而是指向与原始数组相同的内存地址。

因此，`x[0,2] = x[0][2]`，但是第二种情况更低效，因为会在第一次索引后创建一个临时数组。

NumPy 使用 C-order 索引。

### 其它索引选项

NumPy 切片与列表、元组相同，只是可用于多维数组。例如：

```py
>>> x = np.arange(10)
>>> x[2:5]
array([2, 3, 4])
>>> x[:-7]
array([0, 1, 2])
>>> x[1:7:2]
array([1, 3, 5])
>>> y = np.arange(35).reshape(5,7)
>>> y[1:5:2,::3]
array([[ 7, 10, 13],
       [21, 24, 27]])
```

需要注意的是，数组切片不会赋值原数据，而是生成原数据的新视图。这和列表或元组的切片不同。如果不再需要原始数据，建议显式调用 `copy()`。

为了从数组中选择多个值，可以使用数组参数，实现方式有两种：

- 使用索引值数组；
- 使用布尔数组。

### 索引数组

NumPy 数组可以使用其它数组作为索引。使用索引数组返回的是**原数据的副本**，不再是切片获得的视图。

索引数组必须为整数类型。每个索引值表示使用原数组中替换的值。例如：

```py
>>> x = np.arange(10,1,-1)
>>> x
array([10,  9,  8,  7,  6,  5,  4,  3,  2])
>>> x[np.array([3, 3, 1, 8])]
array([7, 7, 9, 2])
```

索引数组 `[3, 3, 1, 8]` 表示返回的数组长度为 4，每个位置的值已由索引指定。

索引数组中可以使用负值：

```py
>>> x[np.array([3,3,-3,8])]
array([7, 7, 4, 2])
```

如果索引越界，抛出错误：

```py
>>> x[np.array([3, 3, 20, 8])]
<type 'exceptions.IndexError'>: index 20 out of bounds 0<=index<9
```

简而言之，使用索引数组返回的数组：

- 与索引数组具有相同的 shape；
- 由被索引数组提供类型和值。

所以，我们也可以使用多维索引数组：

```py
>>> x[np.array([[1,1],[2,3]])]
array([[9, 9],
       [8, 7]])
```

### 多维数组索引

## 索引

`ndarray` 可以使用标准 Python 语法 `x[obj]` 索引。有三种索引类型：字段访问、基本切片以及高级索引。具体采用哪种方式取决于 `obj` 类型。

### 基础切片和索引

NumPy 将 Python 的切片功能扩展到多维。当 `obj` 为切片对象、整数、切片对象元组、整数元组时，发生切片。

## 参考

- https://numpy.org/doc/stable/user/basics.indexing.html
- https://numpy.org/doc/stable/reference/arrays.indexing.html#arrays-indexing
- [Indexing routines](https://numpy.org/doc/stable/reference/routines.indexing.html#routines-indexing)
